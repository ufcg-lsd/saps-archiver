# Install and Configure Archiver

The SAPS Archiver component is responsible to collect data and metadata generated by tasks whose processing have either finished or failed. To this end, the Archive interacts with the SAPS Service Catalog, temporary and permanent storage pools.

## Dependencies

In an apt-based Linux distro, type the below commands to install the Archiver dependencies.

```bash
sudo apt-get update
sudo apt-get -y install openjdk-8-jdk
sudo apt-get -y install maven
sudo apt-get -y install git
sudo apt -y install python-swiftclient
sudo apt-get install -y nfs-kernel-server
```

In addition to above Linux packages, download the own ```saps-engine``` repository (which holds the Archive code), ```saps-common``` and ```saps-catalog```. To fetch and compile, follow the below steps:

```
# saps-common repository
git clone https://github.com/ufcg-lsd/saps-common
cd saps-common
git checkout develop
mvn install

# saps-catalog repository
git clone https://github.com/ufcg-lsd/saps-catalog
cd saps-catalog
git checkout develop
mvn install

# saps-archiver repository
git clone https://github.com/ufcg-lsd/saps-archiver
cd saps-archiver
git checkout develop
mvn install
```

## Configure

### Temporary Storage

The first part of SAPS Archiver configuration deals with the setup of the ```NFS server temporary storage```. Before starting the NFS daemon, please choose an directory, ```$nfs_server_dir_path```, in your machine local file system. The NFS daemon will hold the exported files within this directory. Below commands setup the NFS server:

```
mkdir -p $nfs_server_dir_path
echo "$nfs_server_dir_path *(rw,insecure,no_subtree_check,async,no_root_squash)" >> /etc/exports
sudo service nfs-kernel-server restart
```

To check, list the directories mounted with nfs using the command below and check if the directory you just created appears.
```
showmount -e localhost
```

### Archiver Configuration file


In the second part of the configuation, the[archiver.conf](/config/archiver.conf) file should be customized to indicate how the Archiver should interact with other components, including the SAPS Catalog, temporary and permanent storage pools.

## Run
Once the configuration file is customized, the below commands are used to start and stop the Archiver component.

```
# Start command
bash bin/start-service
```

```
# Stop command
bash bin/stop-service
```
